<div
  class="relative overflow-x-auto shadow-md sm:rounded-lg border border-gray-300 mx-10 my-5 products-container">
  <div
    class="p-5 text-lg font-semibold text-left text-gray-900 bg-white dark:text-white dark:bg-gray-800">
    <h1>Naviguer les jeux</h1>
    <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">
      Rechercher parmis les nombreux jeux disponibles dans le e-shop !
    </p>
  </div>

  <div class="searchbar">
    <app-searchbar-products
      class="searchbar"
      (filters)="filterProducts($event)"></app-searchbar-products>
  </div>

  <div *ngIf="products$ | async as products; else emptyState">
    <table
      cdk-table
      [dataSource]="products"
      class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
      <ng-container cdkColumnDef="picture">
        <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-3"></th>
        <td
          cdk-cell
          *cdkCellDef="let product"
          [ngStyle]="{ 'background-image': 'url(' + product.pictureUrl + ')' }"
          class="px-6 py-4 product-picture">
          <div class="background-blur">
            <img
              class="object-scale-down h-20 content-center"
              src="{{ product.pictureUrl }}"
              alt="" />
          </div>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="product_name">
        <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-3"></th>
        <td
          cdk-cell
          *cdkCellDef="let product"
          class="px-6 py-4 font-bold text-lg text-gray-700 whitespace-nowrap text-ellipsis pl-10">
          {{ product.name }}
        </td>
      </ng-container>

      <ng-container cdkColumnDef="category">
        <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-3">Categorie</th>
        <td cdk-cell *cdkCellDef="let product" class="px-6 py-4 text-gray-600">
          {{ product.category }}
        </td>
      </ng-container>

      <ng-container cdkColumnDef="price">
        <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-3">Prix</th>
        <td
          cdk-cell
          *cdkCellDef="let product"
          class="px-6 py-4 font-bold text-lg">
          {{ product.price }}
        </td>
      </ng-container>

      <ng-container cdkColumnDef="cart">
        <th cdk-header-cell *cdkHeaderCellDef class="px-6 py-3"></th>
        <td
          cdk-cell
          *cdkCellDef="let product"
          class="px-6 py-4 font-bold text-lg">
          <div
            *ngIf="searchProductInShoppingCart(product) === -1; else inCart"
            class="flex items-center space-x-3 ml-20">
            <button
              class="inline-flex items-center p-1 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700"
              type="button"
              (click)="product.quantity = product.quantity - 1">
              <span class="sr-only">Quantity button</span>
              <svg
                class="w-4 h-4"
                aria-hidden="true"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  fill-rule="evenodd"
                  d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                  clip-rule="evenodd"></path>
              </svg>
            </button>
            <div>
              <input
                type="number"
                id="first_product"
                [(ngModel)]="product.quantity"
                class="bg-gray-50 w-14 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block px-2.5 py-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                placeholder="1"
                required />
            </div>
            <button
              class="inline-flex items-center p-1 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-full focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700"
              type="button"
              (click)="product.quantity = product.quantity + 1">
              <span class="sr-only">Quantity button</span>
              <svg
                class="w-4 h-4"
                aria-hidden="true"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  fill-rule="evenodd"
                  d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                  clip-rule="evenodd"></path>
              </svg>
            </button>

            <button
              class="bg-blue-500 disabled:bg-blue-200 enabled:hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full"
              [disabled]="product.quantity < 1"
              (click)="addToCart(product)">
              Acheter
            </button>
          </div>

          <ng-template #inCart>
            <div
              class="flex flex-row bg-green-500 text-white font-bold py-2 px-2 rounded-full ml-20 w-1/3 justify-around cursor-pointer"
              [routerLink]="['cart']">
              <h2 class="text-sm mr-2">Dans le panier</h2>
              <div class="flex">
                <mat-icon>shopping_cart</mat-icon>
              </div>
            </div>
          </ng-template>
        </td>
      </ng-container>

      <tr
        cdk-header-row
        *cdkHeaderRowDef="[
          'picture',
          'product_name',
          'category',
          'price',
          'cart'
        ]"
        class="text-xs border-b-2 border-orange-300 text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"></tr>
      <tr
        cdk-row
        *cdkRowDef="
          let product;
          columns: ['picture', 'product_name', 'category', 'price', 'cart']
        "
        class="bg-white border-b border-orange-200 dark:bg-gray-800 dark:border-gray-700"></tr>
    </table>
  </div>
  <ng-template #emptyState>
    <div *ngIf="isLoading; else noProduct" class="content-table">
      <mat-spinner [diameter]="50"></mat-spinner>
    </div>
    <ng-template #noProduct>
      <div class="content-table">
        <h1>Aucun produit n'a été trouvé</h1>
      </div>
    </ng-template>
  </ng-template>
</div>
